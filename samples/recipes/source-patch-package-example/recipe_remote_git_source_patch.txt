Patching Remote Git Sources using Git Command for Recipe Build:
===============================================================

1. The existing Recipe remote GitHub repository can be modified by using a Patch file in the Recipe Build.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ cd ../meta-layer/recipes-example/
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/meta-layer/recipes-example$ tree hello-remote-git
hello-remote-git
└── hello-remote-git_0.1.bb

0 directories, 1 file

2. The 'WORKDIR' directory has to be fetched to modify the sources and to generate the Patch file.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ bitbake -e hello-remote-git | grep ^WORKDIR=
WORKDIR="/home/prabhat_kiran/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0"
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ cd tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ ls
configure.sstate   deploy-ipks               git                    license-destdir  pkgdata              pseudo                 source-date-epoch
debugsources.list  deploy-rpms               hello-remote-git.spec  package          pkgdata-pdata-input  recipe-sysroot         sysroot-destdir
deploy-debs        deploy-source-date-epoch  image                  packages-split   pkgdata-sysroot      recipe-sysroot-native  temp

3. The sources can be modified in the 'git' directory.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ cd git/
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ ls
LICENSE  Makefile  program  program.c  README.md
---> Before modifying the C file, make a copy of the original C file in the directory. This will be used to generate the Patch file.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/.../build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ cp program.c program_orig.c
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ vi program.c
---> Update the contents of the C file for generating the Patch file.
=> #include <stdio.h>
=> #include "program.h"

=> ...
=> 	display();
=> ...
=> void display()
=> {
=> 	printf ("Patched the Source!\n");
=> }
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ vi program.h
=> void display();
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ ls
LICENSE  Makefile  program  program.c  program.h  program_orig.c  README.md

4. The Patch file to an existing file can be generated using the 'git diff --no-index' command. It works on the files that are not part of a Git repository as well.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/.../hello-remote-git/0.1-r0/git$ git diff --no-index program_orig.c program.c > 0001-Updated-the-C-File.patch
prabhat_kiran@coldstone:~/Documents/.../Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ cat 0001-Updated-the-C-File.patch
diff --git a/program_orig.c b/program.c
index 6cee723..d054db5 100644
--- a/program_orig.c
+++ b/program.c
@@ -1,7 +1,14 @@
 #include <stdio.h>
+#include "program.h"

 int main()
 {
	printf ("Hello World from Remote Git Repository!\n");
+	display();
	return 0;
 }
+
+void display()
+{
+	printf ("Patched the Source!\n");
+}

5. However, the generated Patch file cannot be directly used by the Recipe for patching the sources. The BitBake expects such Patch files to be a part of the Git repository.
---> The Patch file requires certain manual changes so that the BitBake can apply them to the correct source file in their respective directory structure.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/.../hello-remote-git/0.1-r0/git$ vi 0001-Updated-the-C-File.patch
=> diff --git a/program.c b/program.c  <--- The source file name must be the same in both the paths.
=> index 6cee723..d054db5 100644
=> --- a/program.c  <--- If this path is not directly pointing to the directory initialized as a Git repository, modify this path correctly.
=> +++ b/program.c  <--- This path and the file name must be identical to the above specified values.
=> ...

6. The Patch file to add a new file can be generated using the 'diff' command. This command comes handy to generate a one-time Patch file mostly for non-Git sources.
---> Since, there is no existing file for the 'diff' command to compare the original file with the modified file, the new file must be compared against "/dev/null".
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/.../hello-remote-git/0.1-r0/git$ diff -Nau /dev/null program.h > 0002-Added-the-Header-File.patch
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/.../hello-remote-git/0.1-r0/git$ cat 0002-Added-the-Header-File.patch
=> --- /dev/null	2025-09-19 15:02:05.464228654 +0530
=> +++ program.h	2025-09-26 22:46:56.487330159 +0530
=> @@ -0,0 +1 @@
=> +void display();

7. However, the generated Patch file cannot be directly used by the Recipe for patching the sources. The BitBake expects such Patch files to be a part of the Git repository.
---> The Patch file requires certain manual changes so that the BitBake can apply them to the correct source file in their respective directory structure.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/.../hello-remote-git/0.1-r0/git$ vi 0002-Added-the-Header-File.patch
=> --- a/program.h 2025-09-19 15:02:05.464228654 +0530  <--- The '/dev/null' path must be modified correctly to directly point to the directory initialized as a Git repository.
=> +++ b/program.h 2025-09-26 22:46:56.487330159 +0530  <--- This path and the file name must be identical to the above specified values.
=> @@ -0,0 +1 @@
=> +void display();

8. Move the Patch files from the 'git' directory to the Recipe folder in the corresponding Meta-Layer.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ ls
0001-Updated-the-C-File.patch  0002-Added-the-Header-File.patch  LICENSE  Makefile  program  program.c  program.h  program_orig.c  README.md
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/.../hello-remote-git/0.1-r0/git$ cp *.patch ../../../../../../../meta-layer/recipes-example/hello-remote-git/files/
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/.../hello-remote-git/0.1-r0/git$ rm *.patch program.h program_orig.c
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ ls
LICENSE  Makefile  program  program.c  README.md

9. Update the Recipe file in the Recipe folder to include the Patch files in the Recipe Build.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0/git$ cd ../../../../../../
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ cd ../meta-layer/recipes-example/hello-remote-git/
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/meta-layer/recipes-example/hello-remote-git$ vi hello-remote-git_0.1.bb
=> ...
=> SRC_URI = "git://github.com/prabhat_kiran/hello-world.git;branch=master;protocol=https \
=>     file://0001-Updated-the-C-File.patch \
=>     file://0002-Added-the-Header-File.patch \
=> "
=> ...
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/meta-layer/recipes-example/hello-remote-git$ cd ..
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/meta-layer/recipes-example$ tree hello-remote-git
hello-remote-git
├── files
│   ├── 0001-Updated-the-C-File.patch
│   └── 0002-Added-the-Header-File.patch
└── hello-remote-git_0.1.bb

1 directory, 3 files

10. To remove all the files and directories generated during the earlier Build, the 'cleanall' command of the BitBake can be used.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/meta-layer/recipes-example$ cd ../../build/
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ bitbake -c cleanall hello-remote-git
...
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ cd tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ rm -rf *

11. On the Host Machine, run the 'bitbake' command with Target as the Recipe name for a quick Build with the Patch files.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ cd ../../../../../
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ bitbake hello-remote-git
Loading cache: 100% |##############################################################################################################################################| Time: 0:00:00
Loaded 1777 entries from dependency cache.
Parsing recipes: 100% |############################################################################################################################################| Time: 0:00:03
Parsing of 986 .bb files complete (982 cached, 4 parsed). 1781 targets, 159 skipped, 0 masked, 0 errors.
NOTE: Resolving any missing task queue dependencies

Build Configuration:
BB_VERSION           = "2.0.0"
BUILD_SYS            = "x86_64-linux"
NATIVELSBSTRING      = "universal"
TARGET_SYS           = "arm-poky-linux-gnueabi"
MACHINE              = "qemuarm"
DISTRO               = "poky"
DISTRO_VERSION       = "4.0.27"
TUNE_FEATURES        = "arm vfp cortexa15 neon thumb callconvention-hard"
TARGET_FPU           = "hard"
meta
meta-poky
meta-yocto-bsp
meta-layer           = "my-kirkstone:81e0dc80d72d66b7f15a34c0da7a0a8c58809056"
meta-ti-bsp          = "kirkstone:52018a8d730b2977d7163bf56c398905ef9115ac"
meta-arm
meta-arm-toolchain   = "kirkstone:10c27f061b22af78e17a23cf540b69501afc7160"

Initialising tasks: 100% |#########################################################################################################################################| Time: 0:00:00
Sstate summary: Wanted 9 Local 0 Mirrors 0 Missed 9 Current 153 (0% match, 94% complete)
NOTE: Executing Tasks
NOTE: Tasks Summary: Attempted 667 tasks of which 650 didn't need to be rerun and all succeeded.
NOTE: Writing buildhistory
NOTE: Writing buildhistory took: 3 seconds

12. After the Recipe Build is successful, the 'WORKDIR' directory contains all the files and directories generated during the Build.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build$ cd tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ ls
0001-Updated-the-C-File.patch     debugsources.list  deploy-rpms               hello-remote-git.spec  package         pkgdata-pdata-input  recipe-sysroot         sysroot-destdir
0002-Added-the-Header-File.patch  deploy-debs        deploy-source-date-epoch  image                  packages-split  pkgdata-sysroot      recipe-sysroot-native  temp
configure.sstate                  deploy-ipks        git                       license-destdir        pkgdata         pseudo               source-date-epoch

13. The 'do_patch' Task execution log is present in the 'temp/log.do_patch' file. The modified sources can be verified in the 'git' directory.
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ vi temp/log.do_patch
=> ...
=> DEBUG: Searching for 0001-Updated-the-C-File.patch in paths:
=> ...
=>  DEBUG: Searching for 0002-Added-the-Header-File.patch in paths:
=> ...
=> NOTE: Applying patch '0001-Updated-the-C-File.patch' (../meta-layer/recipes-example/hello-remote-git/files/0001-Updated-the-C-File.patch)
=> NOTE: Applying patch '0002-Added-the-Header-File.patch' (../meta-layer/recipes-example/hello-remote-git/files/0002-Added-the-Header-File.patch)
=> DEBUG: Python function patch_do_patch finished
=> DEBUG: Python function do_patch finished
=> DEBUG: Executing python function do_qa_patch
=> DEBUG: Python function do_qa_patch finished
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ ls git/
LICENSE  Makefile  patches  program  program.c  program.h  README.md
prabhat_kiran@coldstone:~/Documents/Learnings/Yocto_Resources/Poky/poky/build/tmp/work/cortexa15t2hf-neon-poky-linux-gnueabi/hello-remote-git/0.1-r0$ ls git/patches
0001-Updated-the-C-File.patch  0002-Added-the-Header-File.patch  series
